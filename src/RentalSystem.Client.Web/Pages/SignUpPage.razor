@page "/signUp"
@using RentalSystem.Shared.DTOs
@using RentalSystem.Client.Web.Http
@inject UsersApiClient Client
@layout EmptyLayout
@inject IJSRuntime JS

<PageTitle>Zarejestruj siÄ™</PageTitle>

<div style="width: 100%; height: 100vh; display: flex; padding: 0px">
    <RadzenColumn Style="width: 60%; background-color: rgba(45, 62, 80, 100); display: flex; font-size: 30px; padding: 0px">
        <RadzenText Text="RentAThing" Style="margin: auto; width: 200px; text-align: center; color: rgb(255,255,255)" />
    </RadzenColumn>

    <RadzenColumn Style="width: 40%; display: flex; background-color: rgba(241,242,246,100); padding: 0px">
        <RadzenColumn Style="text-align: center; display: grid; width: 250px; margin: auto">
            <RadzenText Text="Email" Style="margin: auto; width: 200px; text-align: left" />
            <RadzenTextBox Style="margin: auto; margin-top: 5px; margin-bottom: 10px; width: 200px" @bind-Value="userRequest.Email"></RadzenTextBox>

            <RadzenText Text="Name" Style="margin: auto; width: 200px; text-align: left" />
            <RadzenTextBox Style="margin: auto; margin-top: 5px; margin-bottom: 10px; width: 200px" @bind-Value="userRequest.Name"></RadzenTextBox>

            <RadzenText Text="Surname" Style="margin: auto; width: 200px; text-align: left" />
            <RadzenTextBox Style="margin: auto; margin-top: 5px; margin-bottom: 10px; width: 200px" @bind-Value="userRequest.Surname"></RadzenTextBox>

            <RadzenText Text="Password" Style="margin: auto; width: 200px; text-align: left" />
            <RadzenPassword Style="margin: auto; margin-top: 5px; margin-bottom: 10px; width: 200px" @bind-Value="password"></RadzenPassword>
            <RadzenText Text="Password needs to be at least 6 characters long." Style="font-size: 10px; width: 200px; margin: auto; text-align: left" />

            <RadzenText Text="Repeat password" Style="margin: auto; width: 200px; text-align: left" />
            <RadzenPassword Style="margin: auto; margin-top: 5px; margin-bottom: 10px; width: 200px" @bind-Value="repeatedPassword"></RadzenPassword>

            <RadzenText Text="Phone number" Style="margin: auto; width: 200px; text-align: left" />
            <RadzenTextBox Style="margin: auto; margin-top: 5px; margin-bottom: 10px; width: 200px" @bind-Value="userRequest.PhoneNumber"></RadzenTextBox>

            <RadzenButton Text="Sign up" Click="@SignUp" Style="width: 150px; display: flex; margin: auto; height: 30px; margin-top: 10px; font-style: normal; text-align: center"></RadzenButton>

            <RadzenText Style="margin-top: 15px; font-size: 13px">
                Already have an account?
                <a href="/signIn" style="color: rgba(45, 62, 80, 100)">Sign in!</a>
            </RadzenText>
        </RadzenColumn>
    </RadzenColumn>
</div>


@code {
    private CreateUserRequest userRequest = new CreateUserRequest();
    private string password = "";
    private string repeatedPassword = "";

    async Task SignUp()
    {
        userRequest.Uid = "";
        userRequest.Role = "";

        try
        {
            var jsDefined = await JS.InvokeAsync<bool>("eval", "typeof window.firebaseAuth !== 'undefined'");
            if (!jsDefined)
            {
                Console.WriteLine("firebaseAuth not loaded yet!");
                return;
            }

            var token = await JS.InvokeAsync<string>("firebaseAuth.register", userRequest.Email, password);
            Console.WriteLine("Firebase ID Token: " + token);

            await Client.CreateUser(userRequest, token);
        }
        catch (JSException jsEx)
        {
            Console.WriteLine("JS Error: " + jsEx.Message);
        }
        catch (Exception ex)
        {
            Console.WriteLine("Other Error: " + ex.Message);
        }
    }
}

